---
id: task-1763491291235-rnww6p7vy
status: pending
priority: normal
receivedAt: "2025-11-18T18:41:31.235Z"
updatedAt: "2025-11-18T18:41:31.235Z"
directory: 
repository: /Users/griever/Developer/documentation-cli/alexandria-core-library
tags:
  - api-design
  - filesystem-adapter
  - remote-repositories
  - github
  - architecture
anchors:
  - src/lib/server/GitHubAlexandria.ts
senderId: web-ade
---

# Problem

## Problem

`MemoryPalace` validates that `repositoryRoot` must be an absolute filesystem path (starting with `/`), which prevents using it with remote repositories via custom `FileSystemAdapter` implementations like `GitHubFileSystemAdapter`.

## Current Behavior

```typescript
const adapter = new GitHubFileSystemAdapter('owner', 'repo', 'main', token);
const memoryPalace = new MemoryPalace('owner/repo', adapter);
// ❌ Throws: "directoryPath must be an absolute path starting with '/'."
```

The validation happens in `MemoryPalace.validateRepositoryPath()` at `src/MemoryPalace.ts:144`:

```typescript
if (!fs.isAbsolute(directoryPath)) {
  throw new Error(`❌ directoryPath must be an absolute path...`);
}
```

## Use Case

We want to use the library to fetch and parse CodebaseViews from GitHub repositories without cloning them locally. The `FileSystemAdapter` abstraction suggests this should be possible - we can implement `GitHubFileSystemAdapter` that fetches files via GitHub API.

## Current Workaround

We have to bypass MemoryPalace and parse JSON files directly:

```typescript
const viewFiles = await adapter.readDirAsync('.alexandria/views');
for (const file of viewFiles) {
  const content = await adapter.readFileAsync(file);
  const view = JSON.parse(content); // Manual parsing, no validation
}
```

This loses the benefits of MemoryPalace: validation, type safety, consistent parsing.

## Proposed Solutions

### Option 1: Relax validation for custom adapters
Only enforce absolute paths for default Node.js filesystem, allow custom adapters to use their own path schemes:

```typescript
static validateRepositoryPath(fs: FileSystemAdapter, path: string): ValidatedRepositoryPath {
  // Allow custom adapters to use their own path validation
  if (fs.constructor.name !== 'NodeFileSystemAdapter') {
    return path as ValidatedRepositoryPath;
  }
  
  // Existing validation for filesystem paths
  if (!fs.isAbsolute(path)) {
    throw new Error(...);
  }
  ...
}
```

### Option 2: Add remote repository support
Add explicit support for remote repositories:

```typescript
export class MemoryPalace {
  constructor(
    repositoryRoot: string | { type: 'github'; owner: string; repo: string },
    fileSystem: FileSystemAdapter
  ) {
    // Handle both local and remote paths
  }
}
```

### Option 3: Documentation
If this is by design, document the intended way to use the library with remote repositories and clarify that MemoryPalace is filesystem-only.

## Benefits

- Enables server-side rendering with remote repos (Next.js, Remix, etc.)
- Avoids duplicating parsing/validation logic
- Makes FileSystemAdapter abstraction fully useful
- Consistent API regardless of storage backend

## Reference Implementation

See `GitHubFileSystemAdapter` in code-city-landing and web-ade projects for working adapter implementations.