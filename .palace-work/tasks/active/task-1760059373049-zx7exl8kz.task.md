---
id: task-1760059373049-zx7exl8kz
status: pending
priority: normal
receivedAt: "2025-10-10T01:22:53.049Z"
updatedAt: "2025-10-10T01:22:53.049Z"
directory:
repository: /Users/griever/Developer/core-library
tags:
  - enhancement
  - core-library
  - api
  - codebase-views
anchors:
  - STAMP_FEATURE_DESIGN.md
  - src/commands/
  - node_modules/@a24z/core-library/dist/pure-core/stores/CodebaseViewsStore.d.ts
senderId: alexandria-cli
---

# Add stampView() method to CodebaseViewsStore

# Add stampView() method to CodebaseViewsStore

## Context

Users have been manually editing CodebaseView JSON files to update timestamps and pass staleness checks. This breaks the abstraction contract. We need to formalize this with a proper API method.

## Requirements

Add a new `stampView` method to the `CodebaseViewsStore` class in `@a24z/core-library`:

```typescript
/**
 * Update the timestamp on a CodebaseView to mark it as fresh.
 * This is used to indicate that a view has been reviewed and is current.
 *
 * @param repositoryRootPath - Validated repository path
 * @param viewId - ID of the view to stamp
 * @param timestamp - Optional ISO timestamp (defaults to current time)
 * @returns true if the view was stamped, false if view not found
 */
stampView(
  repositoryRootPath: ValidatedRepositoryPath,
  viewId: string,
  timestamp?: string
): boolean;
```

## Implementation

The implementation can use the existing `updateView` method:

```typescript
stampView(repositoryRootPath: ValidatedRepositoryPath, viewId: string, timestamp?: string): boolean {
  const view = this.getView(repositoryRootPath, viewId);
  if (!view) {
    return false;
  }

  return this.updateView(repositoryRootPath, viewId, {
    timestamp: timestamp ?? new Date().toISOString()
  });
}
```

## Alternative Consideration

Consider enhancing `updateView` to automatically update timestamps on any update with an optional flag:

```typescript
updateView(
  repositoryRootPath: ValidatedRepositoryPath,
  viewId: string,
  updates: Partial<CodebaseView>,
  options?: { updateTimestamp?: boolean } // default: true
): boolean;
```

## Deliverables

1. Add `stampView` method to `CodebaseViewsStore` class
2. Export method in public API
3. Add unit tests for the new method
4. Update TypeScript definitions in dist/
5. Bump package version (patch)

## Related Files

- `src/pure-core/stores/CodebaseViewsStore.ts` - Main implementation
- `dist/pure-core/stores/CodebaseViewsStore.d.ts` - Type definitions
- Test files for CodebaseViewsStore

## Dependencies

- Uses existing `getView()` and `updateView()` methods
- No breaking changes
- Backward compatible

## Testing

Add tests covering:

- Stamping an existing view updates timestamp
- Stamping with custom timestamp works
- Stamping non-existent view returns false
- Timestamp is valid ISO 8601 format

## CLI Integration

The `alexandria-cli` will use this method in a new `alexandria stamp` command to allow users to update timestamps properly without manual JSON editing.

See full design document: STAMP_FEATURE_DESIGN.md in alexandria-cli repository
